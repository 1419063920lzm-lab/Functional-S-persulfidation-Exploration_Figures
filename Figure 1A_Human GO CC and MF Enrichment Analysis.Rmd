---
title: "Figure 1A: Human GO CC and MF Enrichment Analysis"
author: "Yaqian Huang, Zongmin Li, Hongfang Jin"
date: "`r Sys.Date()`"
output: html_document
---

## Figure 1A: Human GO Cellular Component and Molecular Function Enrichment

This R Markdown file reproduces the GO CC and MF enrichment analyses for Figure 1A of the manuscript.  
Input data should be provided as an Excel file in the `data/` folder with at least one column named **`uniprot_id`**.  
Results (plots and Excel tables) will be saved to the `results/` folder.

```{r setup, include=FALSE}
# Global chunk options
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(readxl)
library(clusterProfiler)
library(org.Hs.eg.db)
library(AnnotationDbi)
library(openxlsx)
# Read Excel file from the data folder
gene_data <- read_excel("data/Human_protein.xlsx")

# Extract Uniprot ID vector
genes <- gene_data$uniprot_id
gene_entrez <- AnnotationDbi::select(org.Hs.eg.db,
                                     keys = genes,
                                     keytype = "UNIPROT",
                                     columns = c("ENTREZID"))

# Remove NAs and duplicates
gene_entrez <- gene_entrez[!is.na(gene_entrez$ENTREZID), ]
entrez_ids <- unique(gene_entrez$ENTREZID)

# Print mapping summary
cat("Number of input genes:", length(genes), "\n")
cat("Number of successfully mapped ENTREZ IDs:", length(entrez_ids), "\n")
ego_CC <- enrichGO(gene          = entrez_ids,
                   OrgDb         = org.Hs.eg.db,
                   keyType       = "ENTREZID",
                   ont           = "CC",
                   pAdjustMethod = "BH",
                   pvalueCutoff  = 0.05,
                   qvalueCutoff  = 0.2,
                   minGSSize     = 10,
                   maxGSSize     = 2000,
                   readable      = TRUE)

# Simplify redundant terms
ego_CC_simpl <- simplify(ego_CC,
                         cutoff     = 0.7,
                         by         = "p.adjust",
                         select_fun = min,
                         measure    = "Wang")
ego_MF <- enrichGO(gene          = entrez_ids,
                   OrgDb         = org.Hs.eg.db,
                   keyType       = "ENTREZID",
                   ont           = "MF",
                   pAdjustMethod = "BH",
                   pvalueCutoff  = 0.05,
                   qvalueCutoff  = 0.2,
                   minGSSize     = 10,
                   maxGSSize     = 2000,
                   readable      = TRUE)

# Simplify redundant terms
ego_MF_simpl <- simplify(ego_MF,
                         cutoff     = 0.7,
                         by         = "p.adjust",
                         select_fun = min,
                         measure    = "Wang")
# Save results to Excel
write.xlsx(list(CC = as.data.frame(ego_CC_simpl),
                MF = as.data.frame(ego_MF_simpl)),
           "results/human_GO_CC_MF_result.xlsx")

# Save plots to PDF
pdf("results/Human_GO_CC_barplot.pdf", width = 12, height = 10)
barplot(ego_CC_simpl, showCategory = 30, title = "Top 30 GO CC Terms (Human)")
dev.off()

pdf("results/Human_GO_CC_dotplot.pdf", width = 12, height = 10)
dotplot(ego_CC_simpl, showCategory = 30, title = "Top 30 GO CC Terms (Human)")
dev.off()

pdf("results/Human_GO_MF_barplot.pdf", width = 12, height = 10)
barplot(ego_MF_simpl, showCategory = 30, title = "Top 30 GO MF Terms (Human)")
dev.off()

pdf("results/Human_GO_MF_dotplot.pdf", width = 12, height = 10)
dotplot(ego_MF_simpl, showCategory = 30, title = "Top 30 GO MF Terms (Human)")
dev.off()
