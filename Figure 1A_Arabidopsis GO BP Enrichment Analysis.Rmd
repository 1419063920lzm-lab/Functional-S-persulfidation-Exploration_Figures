---
title: "Figure 1A: Arabidopsis GO BP Enrichment Analysis"
author: "Yaqian Huang, Zongmin Li, Hongfang Jin"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Data input/output
library(readxl)
library(openxlsx)

# Enrichment analysis
library(clusterProfiler)
library(org.At.tair.db)
# Read input file from data/ folder
gene_data <- read_excel("data/Arabidopsis_protein.xlsx")

# Extract TAIR locus IDs (column name should be "TAIR")
genes <- gene_data$TAIR

# Remove NA and duplicates
genes <- unique(genes[!is.na(genes)])

# Print input summary
cat("Number of input genes:", length(genes), "\n")
ego <- enrichGO(gene          = genes,
                OrgDb         = org.At.tair.db,
                keyType       = "TAIR",
                ont           = "BP",
                pAdjustMethod = "BH",
                pvalueCutoff  = 0.05,
                qvalueCutoff  = 0.2,
                minGSSize     = 10,
                maxGSSize     = 2000,
                readable      = TRUE)

# Check if results are valid
if (is.null(ego) || nrow(as.data.frame(ego)) == 0) {
    stop("❌ No significant GO terms found. Please check if gene IDs are correct (standard TAIR locus IDs starting with AT).")
}
ego_simpl <- simplify(ego,
                      cutoff     = 0.7,        # similarity threshold (adjustable 0.5–0.9)
                      by         = "p.adjust", # keep terms with higher significance
                      select_fun = min,
                      measure    = "Wang")
# Export enrichment results to Excel
write.xlsx(as.data.frame(ego_simpl), "results/arabidopsis_GO_BP_result.xlsx")

# Export plots to PDF
pdf("results/Arabidopsis_GO_BP_barplot.pdf", width = 12, height = 10)
barplot(ego_simpl, showCategory = 30, title = "Top 30 GO BP Terms (Arabidopsis)")
dev.off()

pdf("results/Arabidopsis_GO_BP_dotplot.pdf", width = 12, height = 10)
dotplot(ego_simpl, showCategory = 30, title = "Top 30 GO BP Terms (Arabidopsis)")
dev.off()
